@model Bugtracker.Models.IndexViewModel
@using Bugtracker.Models;
@using Microsoft.AspNet.Identity;

<div class="row">
    <div class="col-lg-12">
        <div class="col-md-3">
            <!-- Profile Image -->
            <div class="box box-primary">
                <div class="box-body box-profile">
                    <img class="profile-user-img img-responsive img-circle" src="@Model.User.ProfileIcon" alt="User profile picture">
                    <h3 class="profile-username text-center">@Model.User.DisplayName</h3>
                    <p class="text-muted text-center">
                        @foreach (var role in ViewBag.RoleList)
                        {
                            @role <br />
                        }
                    </p>
                    <ul class="list-group list-group-unbordered">
                        <li class="list-group-item">
                            <b>Tickets Created</b> <a class="pull-right" href="@Url.Action("Index","Tickets")">@ViewBag.UserTickets.Count</a>
                        </li>
                        <li class="list-group-item">
                            <b>Completed Tickets</b> <a class="pull-right">@ViewBag.CompletedTickets.Count</a>
                        </li>
                    </ul>
                    <p class="text-@ViewBag.tColor text-center">@ViewBag.StatusMessage</p>
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div>

        <div class="col-md-9">
            <!-- Profile Image -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#recent-tickets" data-toggle="tab">Recent Tickets</a></li>
                    <li><a href="#timeline" data-toggle="tab">Change Log</a></li>
                    <li><a href="#settings" data-toggle="tab">Personal Settings</a></li>
                    <li><a href="#password" data-toggle="tab">Change Password</a></li>
                </ul>

                <div class="tab-content">
                    <div class="active tab-pane" id="recent-tickets">
                        <table class="display table table-responsive table-bordered table-condensed table-striped">
                            <thead>
                                <tr>
                                    <th>
                                        Ticket
                                    </th>
                                    <th>
                                        Created
                                    </th>
                                    <th>
                                        Status
                                    </th>
                                    <th>
                                        Developer
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ViewBag.TicketList)
                                {
                                    <tr>
                                        <td>
                                            @item.Title
                                        </td>
                                        <td>
                                            @item.Created.ToString("d")
                                        </td>
                                        <td>
                                            <span class="label @item.Status.Name">@item.Status.Name</span>
                                        </td>
                                        <td>
                                            @if (@item.AssignedUser != null)
                                            {
                                                @item.AssignedUser.UserName
                                            }
                                        </td>
                                        <td>
                                            <ul class="list-inline">
                                                <li><a href="@Url.Action("Edit", "Tickets", new { id = item.Id })" data-toggle="tooltip" title="Edit"><i class="fa fa-pencil"></i></a></li>
                                                <li><a href="@Url.Action("Details", "Tickets", new { id = item.Id })" data-toggle="tooltip" title="View"><i class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </td>
                                    </tr>

                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane" id="timeline"> <!--Timeline/Personal History-->
                        <!-- The timeline -->
                        <ul class="timeline timeline-inverse">
                            @foreach (var item in Model.User.TicketHistory.Reverse())
                            {
                        <!-- timeline time label -->
                                <li class="time-label">
                                    <span class="bg-red">
                                        @item.Created.ToString("d")
                                    </span>
                                </li>
                        <!-- /.timeline-label -->
                        <!-- timeline item -->
                                <li>
                                    <i class="fa"><img src="@item.User.ProfileIcon" class="img-circle" style="max-width: 35px" /></i>
                                    <div class="timeline-item">
                                        <span class="time"><i class="fa fa-clock-o"></i> @TimeHelper.TimeAgo(item.Created)</span>
                                        <h3 class="timeline-header">@item.Ticket.Title</h3>
                                        <div class="timeline-body">
                                            <ul>
                                                @{
                                                    string[] property = item.PropertyChanged.Split('.');
                                                    var length = property.Length - 1;
                                                    for (var n = 0; n < length; n++)
                                                    {
                                                        <li>@property[n]</li>
                                                    }
                                                }
                                            </ul>
                                        </div>
                                        <div class="timeline-footer">
                                                <a class="btn btn-primary btn-xs" href="@Url.Action("Details","Tickets", new { id = item.TicketId })">View Changes</a>
                                        </div>
                                    </div>
                                </li>
                        <!-- END timeline item -->
                                                    }
                            <li>
                                <i class="fa fa-clock-o bg-black"></i>
                            </li>
                        </ul>
                    </div> <!--#timeline-->
                    <div class="tab-pane" id="settings"> <!--Personal Information-->
                        @using (Html.BeginForm("Index", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "Multipart/form-data" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary("", new { @class = "text-danger" })
                            <div class="form-group">
                                @Html.LabelFor(m => m.DisplayName, new { @class = "col-sm-2 control-label" })
                                <div class="col-sm-10">
                                    @Html.TextBoxFor(m => m.DisplayName, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.FirstName, new { @class = "col-sm-2 control-label" })
                                <div class="col-sm-10">
                                    @Html.TextBoxFor(m => m.FirstName, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.LastName, new { @class = "col-sm-2 control-label" })
                                <div class="col-sm-10">
                                    @Html.TextBoxFor(m => m.LastName, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.PhoneNumber, new { @class = "col-sm-2 control-label" })
                                <div class="col-sm-10">
                                    @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control", id = "phone", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Profile Icon</label>
                                <div class="col-sm-10">
                                    <input type="file" id="image" name="image" class="form-control" accept="image/*">
                                    <small class="text-muted">For best results, please choose an image with dimension size 128 x 128</small>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.Password, new { @class = "col-sm-2 control-label" })
                                <div class="col-sm-10">
                                    @*@Html.PasswordFor(m => m.Password, new { @class = "form-control" })*@
                                    <input class="form-control" type="Password" name="Password" id="Password" placeholder="Confirm Password" required />
                                    @Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="submit" name ="type" value="personal" class="btn btn-danger">Submit</button>
                                </div>
                            </div>
                        }
                    </div><!-- /.tab-pane -->
                    <div class="tab-pane" id="password"> <!--Change Password-->
                        @using (Html.BeginForm("Index", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary("", new { @class = "text-danger" })
                            <div class="form-group">
                                @Html.LabelFor(m => m.OldPassword, new { @class = "col-md-2 control-label" })
                                <div class="col-md-10">
                                    @Html.PasswordFor(m => m.OldPassword, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.NewPassword, new { @class = "col-md-2 control-label" })
                                <div class="col-md-10">
                                    @Html.PasswordFor(m => m.NewPassword, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.ConfirmPassword, new { @class = "col-md-2 control-label" })
                                <div class="col-md-10">
                                    @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control", @required = "required" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="submit" name="type" value="password" class="btn btn-danger">Submit</button>
                                </div>
                            </div>
                        }
                    </div><!-- /.tab-pane -->
                </div>
            </div>
        </div><!-- /.box -->
    </div>
</div>

@section CustomJS {
    <script src="~/Scripts/jQuery-MaskedInput.js"></script>
    <script>
        $(document).ready(function () {
            $("#phone").mask("(999) 999-9999");

            $("#image").on("change", function () {


            })
        });
    </script>
}