@model IEnumerable<Bugtracker.Models.Project>
@using Microsoft.AspNet.Identity;

<!-- Small boxes (Stat box) -->
<div class="row">
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-aqua">
            <div class="inner">
                <h3>@ViewBag.TotalProjects.Count</h3>
                <p>Total Projects</p>
            </div>
            <div class="icon">
                <i class="fa fa-table"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-green">
            <div class="inner">
                <h3>@ViewBag.TotalTickets.Count</h3>
                <p>Total Tickets</p>
            </div>
            <div class="icon">
                <i class="ion ion-stats-bars"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>@ViewBag.TotalUsers.Count</h3>
                <p>Total Users</p>
            </div>
            <div class="icon">
                <i class="ion ion-person-add"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-red">
            <div class="inner">
                <h3>@ViewBag.CompletedTickets<sup style="font-size: 20px">%</sup></h3>
                <p>Completion of Tickets</p>
            </div>
            <div class="icon">
                <i class="ion ion-pie-graph"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div><!-- ./col -->
</div><!-- /.row -->

@if (User.IsInRole("Administrator") || User.IsInRole("Project Manager"))
{
<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">Recent Projects</h3>
            </div><!-- /.box-header -->
            <div class="box-body">
                <table class="display table table-responsive table-bordered table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>
                                Project
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Created)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Updated)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Status)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Deadline)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Tickets)
                            </th>
                            <th>
                                Project Manager
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Take(3))
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Name)
                                </td>
                                <td>
                                    @item.Created.ToString("d")
                                </td>
                                <td>
                                    @{
                                        if (item.Updated.HasValue)
                                        {
                                            @item.Updated.Value.ToString("d")
                                        }
                                    }
                                </td>
                                <td>
                                    <span class="label @item.Status">@Html.DisplayFor(modelItem => item.Status)</span>
                                </td>
                                <td>
                                    @item.Deadline.Value.ToString("d")
                                </td>
                                <td>
                                    @*<a href="@Url.Action("Index","Tickets", new { id = @item.Id})">@item.Tickets.Count</a>*@
                                    @item.Tickets.Count
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.ProjectManager.UserName)
                                </td>
                                <td>
                                    <ul class="list-inline">
                                        @if (User.Identity.IsAuthenticated && User.IsInRole("Administrator"))
                                        {
                                            <li><a class="" href="@Url.Action("Edit", "Projects", new { id = item.Id })" data-toggle="tooltip" title="Edit"><i class="fa fa-pencil"></i></a></li>
                                            <li><a class="" href="@Url.Action("Delete", "Projects", new { id = item.Id })" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></li>
                                        }
                                        <li><a class="" href="@Url.Action("Create", "Tickets", new { id = item.Id })" data-toggle="tooltip" title="Create Ticket"><i class="fa fa-plus"></i></a></li>
                                    </ul>
                                </td>
                            </tr>

                                        }
                    </tbody>
                </table>
                    <a href="@Url.Action("Index", "Projects")">View All</a>
            </div>
        </div>
    </div>
</div>
}

<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">Recent Tickets</h3>
            </div><!-- /.box-header -->
            <div class="box-body">
                <table class="display table table-bordered table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>
                                Name
                            </th>
                            <th>
                                Author
                            </th>
                            <th>
                                Title
                            </th>
                            <th>
                                Status
                            </th>
                            <th>
                                Type
                            </th>
                            <th>
                                Priority
                            </th>
                            <th>
                                Created
                            </th>
                            <th>
                                Updated
                            </th>
                            <th>
                                Developer
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                                @for (var ticket = 0; ticket < 3 && ticket < ViewBag.UserTickets.Count; ticket++)
                                {
                                    if (User.Identity.IsAuthenticated && User.IsInRole("Administrator") || User.IsInRole("Project Manager") || User.IsInRole("Developer") || ViewBag.UserTickets[ticket].AuthorId == User.Identity.GetUserId())
                                    {
                                    <tr>
                                        <td>
                                            @ViewBag.UserTickets[ticket].Project.Name
                                        </td>
                                        <td>
                                            @ViewBag.UserTickets[ticket].Author.UserName
                                        </td>
                                        <td>
                                            @ViewBag.UserTickets[ticket].Title
                                        </td>
                                        <td>
                                            <span class="label @ViewBag.UserTickets[ticket].Status.Name">@ViewBag.UserTickets[ticket].Status.Name</span>
                                        </td>
                                        <td>
                                            @ViewBag.UserTickets[ticket].TicketType.Type
                                        </td>
                                        <td>
                                            <span class="label @ViewBag.UserTickets[ticket].Priority.Name">@ViewBag.UserTickets[ticket].Priority.Name</span>
                                        </td>
                                        <td>
                                            @ViewBag.UserTickets[ticket].Created.ToString("d")
                                        </td>
                                        <td>
                                            @if (ViewBag.UserTickets[ticket].Updated != null)
                                            {
                                                var updated = ViewBag.UserTickets[ticket].Updated.ToString("d");
                                                @updated
                                            }
                                        </td>
                                        <td>
                                            @if (ViewBag.UserTickets[ticket].AssignedUser != null)
                                            {
                                                @ViewBag.UserTickets[ticket].AssignedUser.UserName;
                                            }
                                        </td>
                                        <td>
                                            <ul class="list-inline">
                                                @if (User.IsInRole("Project Manager") || ViewBag.UserTickets[ticket].Status.Name != "Complete")
                                                {
                                                <li><a href="@Url.Action("Edit", "Tickets", new { id = ViewBag.UserTickets[ticket].Id })" data-toggle="tooltip" title="Edit"><i class="fa fa-pencil"></i></a></li>
                                                }
                                                <li><a href="@Url.Action("Details", "Tickets", new { id = ViewBag.UserTickets[ticket].Id })" data-toggle="tooltip" title="View"><i class="fa fa-eye"></i></a></li>
                                                @if (User.IsInRole("Administrator"))
                                                {
                                                <li><a href="@Url.Action("Delete", "Tickets", new { id = ViewBag.UserTickets[ticket].Id })" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></li>
                                                }
                                            </ul>
                                        </td>
                                    </tr>
                                }
                            }
                    </tbody>
                </table>
                <a href="@Url.Action("Index", "Tickets")">View All</a>
            </div>
        </div>
    </div>
</div>

@section CustomCSS{
    <link rel="stylesheet" href="~/plugins/datatables/dataTables.bootstrap.css">
}

@section CustomJS{
    <!-- DataTables -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables/dataTables.bootstrap.min.js"></script>
    <!-- SlimScroll -->
    <script src="~/plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="~/plugins/fastclick/fastclick.min.js"></script>
    <script>
        $(function () {
            $('table.display').DataTable({
            "paging": false,
            "lengthChange": false,
            "searching": false,
            "ordering": false,
            "info": false,
            "autoWidth": false
            });
        });
    </script>
    }